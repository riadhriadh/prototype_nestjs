"main";_3cc‍.x([["fetchStats",()=>fetchStats],["fetchLogo",()=>fetchLogo],["fetchPkg",()=>fetchPkg]]);let path;_3cc‍.w("path",[["default",["path"],function(v){path=v}]]);let fs;_3cc‍.w("fs",[["default",["fs"],function(v){fs=v}]]);let collectiveSlugFromUrl;_3cc‍.w("./transforms",[["collectiveSlugFromUrl",["collectiveSlugFromUrl"],function(v){collectiveSlugFromUrl=v}]]);let report,reportAndThrowError;_3cc‍.w("./misc",[["report",["report"],function(v){report=v}],["reportAndThrowError",["reportAndThrowError"],function(v){reportAndThrowError=v}]]);




const fetchJson = async url => {
  try {
    return (await global.fetch(`${url}.json`)).json()
  } catch (e) {
    _3cc‍.a("report",report)(e)
    _3cc‍.a("reportAndThrowError",reportAndThrowError)(`Could not fetch ${url}.json`)
  }
}

       const fetchStats = async collectiveUrl => {
  try {
    return await fetchJson(collectiveUrl)
  } catch (e) {
    _3cc‍.a("report",report)(e)
    _3cc‍.a("report",report)(`Could not load the stats for ${_3cc‍.a("collectiveSlugFromUrl",collectiveSlugFromUrl)(collectiveUrl)}`)
  }
};_3cc‍.u(["fetchStats"]);

       const fetchLogo = async logoUrl => {
  if (!logoUrl) {
    // Silent return if no logo has been provided
    return
  }
  if (!logoUrl.match(/^https?:\/\//)) {
    _3cc‍.a("reportAndThrowError",reportAndThrowError)(`Your logo URL isn't well-formatted - ${logoUrl}`)
  }

  try {
    const res = (await global.fetch(logoUrl))
    if (isLogoResponseWellFormatted(res)) {
      return res.text()
    }
    _3cc‍.a("report",report)(`Error while fetching logo from ${logoUrl}. The response wasn't well-formatted`)
  } catch (e) {
    _3cc‍.a("report",report)(`Error while fetching logo from ${logoUrl}`)
  }
};_3cc‍.u(["fetchLogo"]);

const isLogoResponseWellFormatted = res => res.status === 200 && res.headers.get('content-type').match(/^text\/plain/)

       const fetchPkg = pathToPkg => {
  const fullPathToPkg = _3cc‍.a("path",path).resolve(`${pathToPkg}/package.json`)
  try {
    return JSON.parse(_3cc‍.a("fs",fs).readFileSync(fullPathToPkg, 'utf8'))
  } catch (e) {
    _3cc‍.a("reportAndThrowError",reportAndThrowError)(`Could not find package.json at ${fullPathToPkg}`)
  }
};_3cc‍.u(["fetchPkg"]);
